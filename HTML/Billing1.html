<html>
    <meta lang="en-us">
    <head>
        <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-storage.js"></script>
       <link rel="stylesheet" href="../CSS/billing.css">
       <link rel="shortcut icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQdcddUzX0Hsw-JVwLWzvQsZOk-OvgIR86jeg&usqp=CAU">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Billing</title>
        <style>
              .table2 {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    padding: 10%;
    width: 100%;
  }


        </style>
    </head>
        <body>
            <div class="foreground">
                <h1 id="heading"><b>BILLING PORTAL</b></h1>


                <div class="input">
                    <label>Unique ID:</label>
                     <input type="text" name="uid" id="uid">
                     <button id='search' onclick="f()">Search</button>
                     <button id='clear' onclick="clr()">Clear</button>
                    </div>
                    <br/>
                     <br/>
                     <br/>
                     <br/>
                     <br/>
                     <div class="table">
                        <table id="myTable1">
                      <tr>
                        <td id='Name'><b>Name</b></td>
                        <td id="val1"></td>
                      </tr>
                      <tr>
                        <td id="Age"><b>Age</b></td>
                        <td id="val2"></td>
                      </tr>
                       <tr>
                          <td id="Gender"><b>Gender</b></td>
                            <td id="val3"></td>
                           </tr>  
                    </table>
                  
                </div>
                  <br/>
                  <br/>
                  <div class="table2">
                  <table id="myTable2">
                    <td><b>Category</b></td>
                <td><b>Cost</b></td>
                </tr>
                <tr>
                  <td><b>Total</h3></b></td>
                  <td id="total"></td>
                  </tr>
                  </table>
            </div>
            </div>
            </div>
            <script>
                 var firebaseConfig = {
            apiKey: "AIzaSyDGMY7ZwaRcY1GQRvq6s3iW0pySGcDZNpM",
            authDomain: "ihms-6dfbb.firebaseapp.com",
            projectId: "ihms-6dfbb",
            storageBucket: "ihms-6dfbb.appspot.com",
            messagingSenderId: "797803971513",
            appId: "1:797803971513:web:bc709ace17174f3bc0ec68"
            };

            firebase.initializeApp(firebaseConfig);

            const db= firebase.firestore();
            var storage=firebase.storage();
            var uid;
            db.settings({timestampsInSnapshots:true});
            document.getElementById("myTable1").style.visibility="hidden";
            document.getElementById("myTable2").style.visibility="hidden";
            function f(){
              uid=document.getElementById('uid').value;
              if(uid==undefined ||uid==""){
      alert("Please enter the UID");
      return;
  }
              var scost=0; var c; var obj={};
         var items=["Sugar Test","MRI","ECG"];
          //var cost=db.collection("scancost").doc()
          
          var useridref = db.collection("Patients/").doc(uid);
          useridref.get().then((usr)=>{
             if(usr.exists){
               //alert("UID EXISTS");
               document.getElementById("val1").innerHTML=((usr.data()).First_Name)+' '+((usr.data()).Last_Name);
           document.getElementById("val2").innerHTML=(usr.data()).Age;
    document.getElementById("val3").innerHTML=(usr.data()).Gender;
    document.getElementById("uid").disabled=true; 
    document.getElementById("myTable1").style.visibility="visible";
    document.getElementById("myTable2").style.visibility="visible";
    //document.getElementById("myTable").style.visibility="visible";
          for (let i=0;i<items.length;i++){
         
          var docRef = db.collection("Patients/"+uid+'/'+'Reports/').doc(items[i]);
          docRef.get().then((doc) => {
        if (doc.exists) {
           // alert(items[i]+"found");
            var cost=db.collection("Scancost").doc(items[i]);
            cost.get().then((doc1) => {
               c=(doc1.data()).cost;
              //var s=calc(scost,c);
              //function calc(scost,c){
              //scost+=c;
              //return scost;
              //}
              obj[items[i]]=c;
              scost+=c;
              var table = document.getElementById("myTable2");
  var row = table.insertRow(1);
  var cell1 = row.insertCell(0);
  var cell2 = row.insertCell(1);
 cell1.innerHTML = items[i];
  cell2.innerHTML = obj[items[i]];
    document.getElementById("total").innerHTML=scost;
      
        });
            
          }
        else{
          //alert(items[i]+"not found");
        }

      });
    }}
    else{
      alert("User not found");
      clr();
    }
            
  });
 
  }
  function clr(){
    uid="";
    document.getElementById("myTable1").style.visibility="hidden";
    document.getElementById("myTable2").style.visibility="hidden";
    location.reload();
}

            </script>
            </body>  
        </html>